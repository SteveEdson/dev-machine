---
- name: Create system aliases
  lineinfile: dest=~/.zshrc line='alias {{ item.key }}=\"{{ item.value }}\"' insertafter='# aliases'
  with_dict: "{{aliases}}"
  vars:
    aliases:
      gc: "git commit -m"
      gs: git status
      gp: git pull
      bu: brew update
      art: php artisan
      tweet: t tweet
      tweets: t timeline -n 100
      homestead: 'function __homestead() { (cd {{ ansible_env.HOME }}/.composer/vendor/bin/homestead && vagrant $*); unset -f __homestead; }; __homestead'

- name: Make sure files exist
  file: path={{ item }} state=touch
  with_items:
    - '~/.gemrc'

- name: Create gem config
  lineinfile: dest=~/.gemrc line='{{ item }}'
  with_items:
    - "gem: --no-rdoc --no-ri"
    - "install: --no-rdoc --no-ri"

- name: Create Git configs
  command: "git config --global {{ item }}"
  with_items:
    - 'user.name "Steve Edson"'
    - 'core.pager "diff-so-fancy | less --tabs=1,5 -R"'
    - 'color.branch "always"'
    - 'color.diff "auto"'
    - 'color.interactive "always"'
    - 'color.status "always"'
    - 'color.ui "always"'
    - 'color.diff-highlight.oldNormal "red bold"'
    - 'color.diff-highlight.oldHighlight "red bold 52"'
    - 'color.diff-highlight.newNormal "green bold"'
    - 'color.diff-highlight.newHighlight "green bold 22"'
    - 'core.autocrlf "input"'
    - 'core.whitespace "trailing-space,space-before-tab,cr-at-eol"'
    - 'alias.cod checkout development'
    - 'alias.cos checkout staging'
    - 'alias.md merge development'
    - 'alias.last "log -1 HEAD"'
    - 'diff.tool diffmerge'
    - "difftool.diffmerge.cmd 'diffmerge \"$LOCAL\" \"$REMOTE\"'"
    - 'format.pretty "oneline"'
    - 'merge.tool diffmerge'
    - "mergetool.diffmerge.cmd 'diffmerge --merge --result=\"$MERGED\" \"$LOCAL\" \"$(if test -f \"$BASE\"; then echo \"$BASE\"; else echo \"$LOCAL\"; fi)\" \"$REMOTE\"'"
    - 'mergetool.diffmerge.trustExitCode true'
    - 'push.default "simple"'

- name: Enable text selection within quicklook
  osx_defaults: domain=com.apple.finder key=QLEnableTextSelection type=bool value=true state=present

- name: Show hidden files in finder by default
  osx_defaults: domain=com.apple.finder key=AppleShowAllFiles type=bool value=true state=present

- name: Update brew daily
  cron: name="brew autoupdate" special_time="daily"
        user="{{ansible_user_id}}" job="/usr/local/bin/brew update"

- name: Tap required homebrew formulas
  homebrew_tap: tap={{ item }} state=present
  with_items:
    - homebrew/dupes
    - homebrew/versions
    - homebrew/php

- name: Install packages from Homebrew
  homebrew: name={{ item }} state=present update_homebrew=yes upgrade_all=yes
  with_items:
    - php70
    - php70-xdebug
    - php-code-sniffer
    - phpmd
    - speedtest_cli
    - httpie
    - exiftool
    - git-extras
    - pandoc
    - tree
    - composer
    - node
    - q
    - git-cal
    - aria2
    - jq
    - diff-so-fancy
    - beanstalkd
    - antigen
    - autoenv
    - android-sdk

- name: Install Brew Cask packages
  ignore_errors: yes
  homebrew_cask: name={{ item }} state=present
  with_items:
    - java
    - alfred
    - virtualbox
    - vagrant
    - phpstorm
    - dash
    - google-chrome
    - firefox
    - atom
    - iterm2
    - imageoptim
    - sequel-pro
    - qlstephen
    - qlmarkdown
    - quicklook-csv
    - betterzipql
    - dropbox
    - marked
    - licecap
    - caret
    - diffmerge
    - bitbar
    - slack

- name: ZSH Config
  lineinfile: dest=~/.zshrc line='{{ item }}'
  with_items:
    - "source $(brew --prefix)/share/antigen.zsh"
    - "antigen bundle zsh-users/zsh-syntax-highlighting"
    - "antigen bundle kennethreitz/autoenv"
    - "antigen apply"
    - "export EDITOR=pstorm"

- name: Install Gem packages
  gem: name={{ item }} state=present
  with_items:
    - jekyll
    - t
    - sass
    - compass
    - susy
    - breakpoint
    - gist

- name: Install NPM packages
  npm: name={{ item }} state=present global=yes
  with_items:
    - electron-prebuilt
    - bower
    - gulp
    - jspm
    - pm2
    - grunt-cli
    - npm-check-updates
    - yo
    - babel
    - plato
    - webpack
    - mocha
    - susy
    - nativefier
    - vue-cli
    - autochecker
  become: yes

- name: Remove Brew Cask packages
  ignore_errors: yes
  homebrew_cask: name={{ item }} state=absent
  with_items:
    - nanobox

- name: Make sure PIP is installed
  easy_install: name=pip state=latest
  become: yes

- name: Install PIP packages
  pip: name={{ item }} state=present
  with_items:
    - tldr
    - proselint
  become: yes

- name: Install global Composer packages
  ignore_errors: yes
  composer: 
    command: "require" 
    working_dir: "{{ ansible_env.HOME }}/.composer"
    no_dev: no
    arguments: "{{ item }}"
  with_items:
    - "laravel/installer"
    - "laravel/homestead"
    - "getkirby/cli"
    - "humbug/humbug"
    - "laravel/valet"

- name: Setup launch agents for services
  command: launchctl load {{ ansible_env.HOME }}/Library/LaunchAgents/homebrew.mxcl.{{ item }}.plist
  with_items:
    - mysql
    - beanstalkd
